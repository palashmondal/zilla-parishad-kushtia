<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আর্থিক সহযোগিতা | জেলা পরিষদ, কুষ্টিয়া</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">

<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
<link rel="shortcut icon" href="favicon/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="ZPK" />
<link rel="manifest" href="favicon/site.webmanifest" />


    <style>
        /*
         * ── PALETTE (Light Blue / Teal Theme) ──────────────
         *   Deep Teal      #0d7377   (ring, accents, buttons)
         *   Ocean Blue     #14919b   (lighter accent)
         *   Sky Blue       #0ea5e9   (glow, badge highlights)
         *   Light Teal     #5eead4   (avatar bg, focus ring)
         *   Page bg        #f0f9ff   (very light blue-tinted white)
         * ─────────────────────────────────────────────────────── */

        * { box-sizing: border-box; }
        body { font-family: 'Hind Siliguri', sans-serif; }

        /* ──── floating nav buttons (LEFT side) ──── */
        .float-nav-container {
            position: fixed;
            top: 30px;
            left: 40px;
            z-index: 50;
            display: flex;
            gap: 10px;
        }
        .float-nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
            border: 1.5px solid #a5f3fc;
            border-radius: 2rem;
            box-shadow: 0 4px 20px rgba(13,115,119,0.15);
            font-size: 13px;
            font-weight: 600;
            color: #0d7377;
            text-decoration: none;
            transition: all 0.25s ease;
        }
        .float-nav-btn:hover {
            background: linear-gradient(135deg, #0d7377 0%, #14919b 100%);
            color: #fff;
            border-color: #0d7377;
            box-shadow: 0 6px 24px rgba(13,115,119,0.3);
            transform: translateY(-2px);
        }
        .float-nav-btn.active {
            background: linear-gradient(135deg, #0d7377 0%, #14919b 100%);
            color: #fff;
            border-color: #0d7377;
        }
        .float-nav-btn svg {
            width: 16px;
            height: 16px;
        }

        /* ──── glow spheres ──── */
        .glow-sphere {
            position: absolute; width: 900px; height: 900px;
            border-radius: 50%; z-index: 0;
            filter: blur(110px); opacity: 0.22;
            animation: float 22s infinite alternate;
            pointer-events: none;
        }
        .sphere-1 { background: radial-gradient(circle, #0d7377 0%, transparent 68%); top: -28%; left: -14%; }
        .sphere-2 { background: radial-gradient(circle, #0ea5e9 0%, transparent 68%); bottom: -18%; right: -10%; }
        .sphere-3 { background: radial-gradient(circle, #14919b 0%, transparent 70%); top: 40%; right: -20%; opacity: 0.14; }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(50px,44px); } }

        /* ──── year dropdown trigger ──── */
        .year-select-wrap { position: relative; flex-shrink: 0; }
        .year-select-btn {
            display: flex; align-items: center; gap: 7px;
            background: #e0f7fa; border: none;
            border-radius: 1rem; padding: 11px 15px;
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 13px; font-weight: 700; color: #0d5c5f;
            cursor: pointer; user-select: none;
            transition: background 0.2s, color 0.2s;
            white-space: nowrap;
        }
        .year-select-btn:hover { background: #b2ebf2; }
        .year-select-btn .chevron { width: 14px; height: 14px; transition: transform 0.25s; color: #0d7377; }
        .year-select-btn.open .chevron { transform: rotate(180deg); }
        .year-select-btn .dot { width: 7px; height: 7px; border-radius: 50%; background: #0d7377; flex-shrink: 0; }

        /* year dropdown panel */
        .year-panel {
            position: absolute; top: calc(100% + 10px); left: 0;
            background: #fff; border: 1px solid #a5f3fc;
            border-radius: 1rem; box-shadow: 0 14px 44px rgba(13,115,119,0.13);
            min-width: 175px; overflow: hidden; z-index: 200;
            opacity: 0; transform: translateY(-8px) scale(0.97);
            transition: opacity 0.28s cubic-bezier(.34,1.56,.64,1), transform 0.28s cubic-bezier(.34,1.56,.64,1);
            pointer-events: none;
        }
        .year-panel.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }

        .year-option {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 16px; font-size: 13px; font-weight: 600;
            color: #0d5c5f; cursor: pointer;
            transition: background 0.15s, color 0.15s;
            border-bottom: 1px solid #e0f7fa;
        }
        .year-option:last-child { border-bottom: none; }
        .year-option:hover { background: #e0f7fa; color: #0d7377; }
        .year-option.active { background: #e0f7fa; color: #0d7377; }
        .year-option .opt-dot { width: 7px; height: 7px; border-radius: 50%; background: transparent; flex-shrink: 0; transition: background 0.2s; }
        .year-option.active .opt-dot { background: #0d7377; }

        /* ──── search bar ──── */
        .search-bar {
            display: flex; align-items: center; gap: 10px;
            background: #fff; border: 1.5px solid #a5f3fc;
            border-radius: 1.6rem; padding: 9px 9px 9px 11px;
            box-shadow: 0 8px 32px rgba(13,115,119,0.08), 0 2px 6px rgba(0,0,0,0.04);
            transition: border-color 0.25s, box-shadow 0.25s;
        }
        .search-bar:focus-within {
            border-color: #5eead4;
            box-shadow: 0 8px 32px rgba(13,115,119,0.14), 0 0 0 3px rgba(94,234,212,0.35);
        }
        .search-bar .search-icon { color: #14919b; flex-shrink: 0; margin-left: 2px; }
        .search-bar input {
            flex: 1; border: none; background: transparent;
            font-family: 'Hind Siliguri', sans-serif;
            font-size: 16px; color: #1e293b; outline: none;
            padding: 10px 4px; min-width: 0;
        }
        .search-bar input::placeholder { color: #7dd3d0; }
        .search-bar .search-btn {
            flex-shrink: 0;
            background: linear-gradient(135deg, #0d7377 0%, #14919b 100%);
            color: #fff; border: none; border-radius: 1.2rem;
            padding: 13px 30px; font-family: 'Hind Siliguri', sans-serif;
            font-size: 15px; font-weight: 700; cursor: pointer;
            transition: opacity 0.2s, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 16px rgba(13,115,119,0.38);
        }
        .search-bar .search-btn:hover {
            opacity: 0.92;
            box-shadow: 0 6px 20px rgba(13,115,119,0.45);
        }
        .search-bar .search-btn:active { transform: scale(0.96); }

        /* ──── suggestions dropdown ──── */
        .sugg-wrap { position: relative; }
        #dropdown {
            position: absolute; top: calc(100% + 10px); left: 0; right: 0;
            background: #fff; border: 1px solid #a5f3fc;
            border-radius: 1.2rem; box-shadow: 0 16px 48px rgba(13,115,119,0.12);
            overflow: hidden; z-index: 150;
            animation: dropIn 0.38s cubic-bezier(.34,1.56,.64,1) both;
        }
        #results { overflow-y: auto; overflow-x: hidden; }
        #results::-webkit-scrollbar { width: 6px; }
        #results::-webkit-scrollbar-track { background: transparent; }
        #results::-webkit-scrollbar-thumb { background: #5eead4; border-radius: 3px; }
        #results::-webkit-scrollbar-thumb:hover { background: #0d7377; }
        @keyframes dropIn { from { opacity:0; transform:translateY(-14px); } to { opacity:1; transform:translateY(0); } }
        @keyframes rowFadeIn { to { opacity:1; transform:translateY(0); } }
        #dropdown.hidden { display: none; }

        .result-row {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 16px; cursor: pointer;
            border-bottom: 1px solid #e0f7fa;
            transition: background 0.22s ease, transform 0.22s ease, box-shadow 0.22s ease;
            -webkit-user-select: none; user-select: none;
            opacity: 0; transform: translateY(8px);
            animation: rowFadeIn 0.32s cubic-bezier(.34,1.56,.64,1) both;
        }
        .result-row:last-child { border-bottom: none; }
        .result-row:hover {
            background: linear-gradient(90deg, #e0f7fa, #f0f9ff);
            transform: translateX(3px);
            box-shadow: inset 3px 0 0 #0d7377;
        }
        .result-row:hover .avatar-placeholder { border-color: #0d7377; box-shadow: 0 0 10px rgba(94,234,212,0.5); }

        .avatar-placeholder {
            width: 48px; height: 48px; flex-shrink: 0;
            border-radius: 12px;
            background: linear-gradient(135deg, #a5f3fc 0%, #5eead4 100%);
            border: 2px solid #a5f3fc;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.22s;
        }
        .avatar-placeholder svg { width: 24px; height: 24px; color: #0d7377; }

        .result-info { flex: 1; min-width: 0; }
        .result-line-1 { display: flex; align-items: center; gap: 7px; flex-wrap: wrap; margin-bottom: 5px; }
        .result-name { font-size: 16px; font-weight: 700; color: #0f172a; }
        .result-category { font-size: 12px; font-weight: 600; color: #0d5c5f; }
        .result-amount { font-size: 13px; font-weight: 700; color: #0ea5e9; }
        .result-year-badge {
            font-size: 11px;
            font-weight: 700;
            color: #0d5c5f;
            background: #ccfbf1;
            padding: 2px 8px;
            border-radius: 5px;
        }
        .result-line-2 {
            font-size: 13px; color: #64748b; font-weight: 500;
            text-align: left; overflow: hidden;
            white-space: nowrap; text-overflow: ellipsis;
        }
        .result-line-2 .label { font-weight: 600; color: #0d7377; }
        #more-hint { padding: 11px 16px; background: #e0f7fa; border-top: 1px solid #a5f3fc; text-align: center; }
        #more-hint.hidden { display: none; }

        /* Loading spinner */
        .spinner {
            border: 3px solid #e0f7fa;
            border-top: 3px solid #0d7377;
            border-radius: 50%; width: 24px; height: 24px;
            animation: spin 1s linear infinite; margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ──── modal ──── */
        .modal-backdrop {
            background: rgba(13,115,119,0.12);
            backdrop-filter: blur(18px);
            opacity: 0; pointer-events: none;
            transition: opacity 0.32s cubic-bezier(.4,0,.2,1);
        }
        .modal-backdrop.open { opacity: 1; pointer-events: auto; }
        .modal-card {
            transform: translateY(28px) scale(0.96); opacity: 0;
            transition: transform 0.38s cubic-bezier(.34,1.56,.64,1), opacity 0.3s cubic-bezier(.4,0,.2,1);
        }
        .modal-backdrop.open .modal-card { transform: translateY(0) scale(1); opacity: 1; }

        /* modal internals */
        .modal-avatar {
            background: linear-gradient(135deg, #a5f3fc, #5eead4);
        }
        .modal-amount-box {
            background: linear-gradient(135deg, #e0f7fa 0%, #a5f3fc 60%, #ccfbf1 100%);
            border: 1px solid #5eead4;
        }
        .modal-status-badge {
            background: linear-gradient(135deg, #0d7377, #0ea5e9);
        }
        .modal-close-btn {
            background: linear-gradient(135deg, #0d7377 0%, #14919b 100%);
            transition: filter 0.2s, transform 0.1s;
        }
        .modal-close-btn:hover { filter: brightness(1.12); }
        .modal-close-btn:active { transform: scale(0.97); }

        /* application details box */
        .app-details-box {
            background: #f0f9ff;
            border: 1px solid #a5f3fc;
            border-radius: 0.75rem;
            padding: 12px;
            font-size: 13px;
            color: #0d5c5f;
            line-height: 1.5;
        }

        input:focus { outline: none !important; }

        /* ──── Admin Profile Display with Dropdown (RIGHT side) ──── */
        .admin-profile {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
        }
        .admin-profile.hidden {
            display: none;
        }
        .admin-profile-card {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px 10px 10px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
            border: 1.5px solid #a5f3fc;
            border-radius: 2rem;
            box-shadow: 0 4px 20px rgba(13,115,119,0.15);
            transition: all 0.25s ease;
            cursor: pointer;
            user-select: none;
        }
        .admin-profile-card:hover {
            border-color: #0d7377;
            box-shadow: 0 6px 24px rgba(13,115,119,0.25);
        }
        .admin-profile-card.open {
            border-color: #0d7377;
            box-shadow: 0 6px 24px rgba(13,115,119,0.3);
        }
        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a5f3fc 0%, #5eead4 100%);
            border: 2px solid #0d7377;
            display: flex;
            align-items: center;
            justify-center;
            flex-shrink: 0;
            overflow: hidden;
        }
        .admin-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .admin-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
            flex: 1;
        }
        .admin-name {
            font-size: 13px;
            font-weight: 700;
            color: #0d7377;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .admin-role {
            font-size: 10px;
            font-weight: 600;
            color: #0d5c5f;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .admin-chevron {
            width: 16px;
            height: 16px;
            color: #0d7377;
            transition: transform 0.25s ease;
            flex-shrink: 0;
        }
        .admin-profile-card.open .admin-chevron {
            transform: rotate(180deg);
        }

        /* Profile Dropdown Menu */
        .admin-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            min-width: 200px;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(12px);
            border: 1.5px solid #a5f3fc;
            border-radius: 1.2rem;
            box-shadow: 0 8px 32px rgba(13,115,119,0.2);
            opacity: 0;
            transform: translateY(-10px) scale(0.95);
            transition: opacity 0.25s ease, transform 0.25s ease;
            pointer-events: none;
            overflow: hidden;
        }
        .admin-dropdown.open {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #2d4a3e;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            border-bottom: 1px solid rgba(165,243,252,0.3);
        }
        .dropdown-item:last-child {
            border-bottom: none;
        }
        .dropdown-item:hover {
            background: rgba(165,243,252,0.2);
            color: #0d7377;
        }
        .dropdown-item.logout {
            color: #dc2626;
        }
        .dropdown-item.logout:hover {
            background: rgba(220,38,38,0.1);
            color: #b91c1c;
        }
        .dropdown-item svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        /* ──── Login Button (shown when not logged in) - RIGHT side ──── */
        .login-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
            border: 1.5px solid #a5f3fc;
            border-radius: 2rem;
            box-shadow: 0 4px 20px rgba(13,115,119,0.15);
            font-size: 13px;
            font-weight: 600;
            color: #0d7377;
            text-decoration: none;
            transition: all 0.25s ease;
            cursor: pointer;
        }
        .login-button:hover {
            background: linear-gradient(135deg, #0d7377 0%, #14919b 100%);
            color: #fff;
            border-color: #0d7377;
            box-shadow: 0 6px 24px rgba(13,115,119,0.3);
            transform: translateY(-2px);
        }
        .login-button svg {
            width: 16px;
            height: 16px;
        }
        .login-button.hidden {
            display: none;
        }

        /* ──── Dashboard Button (shown when logged in) - LEFT side ──── */
        .dashboard-button {
            position: fixed;
            top: 30px;
            left: 240px;
            z-index: 50;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
            border: 1.5px solid #a5f3fc;
            border-radius: 2rem;
            box-shadow: 0 4px 20px rgba(13,115,119,0.15);
            font-size: 13px;
            font-weight: 600;
            color: #0d7377;
            text-decoration: none;
            transition: all 0.25s ease;
        }
        .dashboard-button:hover {
            background: linear-gradient(135deg, #0d7377 0%, #14919b 100%);
            color: #fff;
            border-color: #0d7377;
            box-shadow: 0 6px 24px rgba(13,115,119,0.3);
            transform: translateY(-2px);
        }
        .dashboard-button svg {
            width: 16px;
            height: 16px;
        }
        .dashboard-button.hidden {
            display: none;
        }

        /* ──── Edit/Delete Modals ──── */
        #edit-modal,
        #delete-modal {
            background: rgba(13,115,119,0.12);
            backdrop-filter: blur(18px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.32s cubic-bezier(.4,0,.2,1);
        }
        #edit-modal.open,
        #delete-modal.open {
            opacity: 1;
            pointer-events: auto;
        }
        #edit-modal .modal-card,
        #delete-modal .modal-card {
            opacity: 0;
            transform: translateY(-20px) scale(0.97);
            transition: opacity 0.38s cubic-bezier(.34,1.56,.64,1),
                        transform 0.38s cubic-bezier(.34,1.56,.64,1);
        }
        #edit-modal .modal-card.open,
        #delete-modal .modal-card.open {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Input/textarea/select focus */
        input:focus, textarea:focus, select:focus {
            outline: none;
        }

        /* ──── Beautiful Dropdown Styling ──── */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%230d7377' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 44px !important;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            color: #1f2937;
        }

        select:hover {
            border-color: #14b8a6 !important;
            background-color: #f0fdfa;
            box-shadow: 0 2px 8px rgba(13, 115, 119, 0.08);
        }

        select:focus {
            border-color: #0d7377 !important;
            background-color: #ffffff;
            box-shadow: 0 0 0 3px rgba(94, 234, 212, 0.25), 0 4px 12px rgba(13, 115, 119, 0.12);
            transform: translateY(-1px);
        }

        select:active {
            transform: translateY(0);
        }

        select option {
            padding: 10px 16px;
            font-weight: 600;
            color: #1f2937;
            background-color: #ffffff;
        }

        select option:hover,
        select option:focus,
        select option:checked {
            background: linear-gradient(135deg, #e0f2fe 0%, #ccfbf1 100%);
            color: #0d7377;
        }

        select option[value=""] {
            color: #9ca3af;
            font-style: italic;
        }

        /* Enhanced select when populated/selected */
        select:not([value=""]):valid {
            background-color: #f0fdfa;
            border-color: #5eead4;
        }
    </style>
</head>
<body class="bg-[#f0f9ff] min-h-screen flex flex-col items-start justify-start relative overflow-x-hidden p-4 pt-10 md:pt-20">

    <!-- Admin Profile Display (shown when logged in) -->
    <div id="admin-profile" class="admin-profile hidden">
        <div class="admin-profile-card" onclick="toggleAdminDropdown(event)">
            <div class="admin-avatar" id="admin-avatar">
                <!-- Profile photo or default icon -->
                <svg class="w-6 h-6 text-[#0d7377]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
            </div>
            <div class="admin-info">
                <div class="admin-name" id="admin-name">প্রশাসক</div>
            </div>
            <svg class="admin-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>

            <!-- Dropdown Menu -->
            <div class="admin-dropdown" id="admin-dropdown" onclick="event.stopPropagation()">
                <div class="dropdown-item" onclick="goToDashboard()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    ড্যাশবোর্ড
                </div>
                <div class="dropdown-item" onclick="goToProfile()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    প্রোফাইল পেজ
                </div>
         
                <div class="dropdown-item logout" onclick="logout()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    লগআউট
                </div>
            </div>
        </div>
    </div>

    <!-- Login Button (shown when not logged in) -->
    <a href="/admin/login.html" id="login-button" class="login-button hidden">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
        </svg>
        প্রবেশ করুন
    </a>



    <!-- Floating Navigation Buttons -->
    <div class="float-nav-container">
        <a href="projects.html" class="float-nav-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
            প্রকল্প
        </a>
        <a href="scholarship.html" class="float-nav-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
            শিক্ষাবৃত্তি
        </a>
        <a href="humanitarian_aid.html" class="float-nav-btn active">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
            আর্থিক সহযোগিতা
        </a>
    </div>

    <div class="glow-sphere sphere-1"></div>
    <div class="glow-sphere sphere-2"></div>
    <div class="glow-sphere sphere-3"></div>

    <div class="w-full max-w-4xl mx-auto text-center" style="position:relative; z-index:10;">

        <!-- Logo -->
        <div class="mb-5">
            <div class="inline-block p-4 bg-white rounded-[2rem] shadow-lg border border-white">
                <img src="assets/images/zpk_logo.jpg" alt="Seal" class="w-32 h-32">
            </div>
        </div>

        <h1 class="text-3xl md:text-5xl font-bold text-slate-900 mb-7">জেলা পরিষদ, কুষ্টিয়া</h1>
        <p class="text-base md:text-xl font-bold text-[#0d7377] mb-8 tracking-wide">আর্থিক সহযোগিতাপ্রাপ্ত উপকারভোগী ডাটাবেস</p>

        <!-- Search bar with embedded year selector -->
        <div class="sugg-wrap max-w-3xl mx-auto">
            <div class="search-bar">

                <!-- Year dropdown trigger -->
                <div class="year-select-wrap">
                    <button class="year-select-btn" id="yearBtn" onclick="toggleYearPanel(event)">
                        <span class="dot"></span>
                        <span id="yearBtnLabel">সকল অর্থবছর</span>
                        <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                    </button>
                    <!-- Year panel - will be populated dynamically from database -->
                    <div class="year-panel" id="yearPanel">
                        <div class="year-option active" data-year="all" onclick="pickYear(this, event)">
                            <span class="opt-dot"></span> সকল অর্থবছর
                        </div>
                    </div>
                </div>

                <!-- Search icon -->
                <svg class="search-icon" width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>

                <!-- Input -->
                <input type="text" id="search-input" placeholder="" autocomplete="off">

                <!-- Button -->
                <button class="search-btn" onclick="triggerSearch()">খুঁজুন</button>
            </div>

            <!-- Suggestions dropdown -->
            <div id="dropdown" class="hidden">
                <div id="results"></div>
                <div id="more-hint" class="hidden">
                    <span style="font-size:11px; color:#64748b; font-weight:600;">আরও ফলাফল দেখতে বিস্তারিত অনুসন্ধান করুন</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ───── MODAL ───── -->
    <div id="modal" class="modal-backdrop fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="modal-card bg-white w-full max-w-lg rounded-[2rem] shadow-2xl p-6 relative">
            <!-- Header -->
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3 flex-1">
                    <div class="modal-avatar w-14 h-14 rounded-xl flex items-center justify-center text-[#0d7377] flex-shrink-0">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="1.5"/></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h2 id="m-name" class="text-xl font-extrabold text-slate-900 leading-tight mb-0.5"></h2>
                        <p id="m-category" class="text-sm font-semibold text-[#0d7377]"></p>
                    </div>
                </div>
                <button onclick="closeModal()" class="text-slate-300 hover:text-[#ef4444] transition-colors p-1 flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>

            <div class="space-y-3 border-t border-[#a5f3fc] pt-4">
                <!-- Row 1: Parents -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">পিতার নাম</p>
                        <p id="m-father" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">মাতার নাম</p>
                        <p id="m-mother" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                </div>

                <!-- Row 2: Address & Mobile -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">ঠিকানা</p>
                        <p id="m-address" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">মোবাইল</p>
                        <p id="m-mobile" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                </div>

                <!-- Row 3: Upazila, Zila, NID -->
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">উপজেলা</p>
                        <p id="m-upazila" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">জেলা</p>
                        <p id="m-zila" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">এনআইডি/জন্ম নিবন্ধন</p>
                        <p id="m-nid" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                </div>

                <!-- Row 4: Profession, Relation, Year -->
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">পেশা</p>
                        <p id="m-profession" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">সম্পর্ক</p>
                        <p id="m-relation" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">অর্থবছর</p>
                        <p id="m-year" class="font-semibold text-slate-800 text-[14px]"></p>
                    </div>
                </div>

                <!-- Reference -->
                <div>
                    <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">রেফারেন্স</p>
                    <p id="m-reference" class="font-semibold text-slate-800 text-[14px]"></p>
                </div>

                <!-- Application Details -->
                <div>
                    <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-1">আবেদনের বিবরণ</p>
                    <div id="m-app-details" class="app-details-box"></div>
                </div>

                <!-- Payment Details Box - At Bottom -->
                <div class="modal-amount-box p-4 rounded-xl">
                    <div class="flex justify-between items-center mb-3">
                        <div>
                            <p class="text-[10px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-0.5">জেলা পরিষদ কর্তৃক প্রদত্ত অর্থ</p>
                            <p id="m-amount" class="text-xl font-black text-[#0d7377] tracking-tight"></p>
                        </div>
                        <div class="text-right">
                            <span class="modal-status-badge inline-flex items-center gap-1.5 px-3 py-1.5 text-white text-[10px] font-bold rounded-full uppercase tracking-tight">
                                <span class="w-1.5 h-1.5 rounded-full bg-[#5eead4] animate-pulse"></span>
                                Delivered
                            </span>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 pt-2 border-t border-[#5eead4]">
                        <div>
                            <p class="text-[9px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-0.5">ব্যাংক</p>
                            <p id="m-bank" class="font-semibold text-[#0d5c5f] text-[12px]"></p>
                        </div>
                        <div>
                            <p class="text-[9px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-0.5">চেক নম্বর</p>
                            <p id="m-check-no" class="font-semibold text-[#0d5c5f] text-[12px]"></p>
                        </div>
                        <div>
                            <p class="text-[9px] font-bold text-[#0d5c5f] uppercase tracking-wider mb-0.5">চেকের তারিখ</p>
                            <p id="m-check-date" class="font-semibold text-[#0d5c5f] text-[12px]"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Action Buttons (hidden by default, shown when admin logged in) -->
            <div id="admin-actions" class="hidden mt-6 pt-4 border-t border-[#a5f3fc] flex gap-3">
                <button type="button" onmousedown="event.stopPropagation(); openEditModal();" class="flex-1 py-3 px-4 rounded-xl font-bold text-sm
                    bg-gradient-to-r from-[#0d7377] to-[#14919b] text-white
                    shadow-lg hover:shadow-xl transition-all duration-200
                    active:scale-[0.98] flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                    </svg>
                    সম্পাদনা করুন
                </button>
                <button id="delete-btn" type="button" onmousedown="event.stopPropagation(); openDeleteModal();" class="py-3 px-4 rounded-xl font-bold text-sm
                    bg-gradient-to-r from-[#ef4444] to-[#dc2626] text-white
                    shadow-lg hover:shadow-xl transition-all duration-200
                    active:scale-[0.98] flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                    মুছে ফেলুন
                </button>
            </div>

            <button onclick="closeModal()" class="modal-close-btn w-full mt-4 text-white font-bold py-3 rounded-xl shadow-lg active:scale-[0.98] text-[14px]">বন্ধ করুন</button>
        </div>
    </div>

    <!-- ───── EDIT MODAL ───── -->
    <div id="edit-modal" class="modal-backdrop fixed inset-0 z-[110] flex items-center justify-center p-4 hidden">
        <div class="modal-card bg-white w-full max-w-3xl rounded-[2rem] shadow-2xl p-8 relative max-h-[90vh] overflow-y-auto">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-[#0d7377]">রেকর্ড সম্পাদনা</h2>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-red-500 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Edit Form -->
            <form id="edit-form" class="space-y-4" onsubmit="handleEditSubmit(event)">
                <input type="hidden" id="edit-id">

                <!-- Field groups -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Name -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">নাম</label>
                        <input type="text" id="edit-name" required
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Father Name -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">পিতার নাম</label>
                        <input type="text" id="edit-father-name"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Mother Name -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">মাতার নাম</label>
                        <input type="text" id="edit-mother-name"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- NID/Birth Reg -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">জাতীয় পরিচয়পত্র/জন্ম নিবন্ধন</label>
                        <input type="text" id="edit-nid-birth"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Profession -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">পেশা</label>
                        <input type="text" id="edit-profession"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Relation to Beneficiary -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">সুবিধাভোগীর সাথে সম্পর্ক</label>
                        <input type="text" id="edit-relation"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Mobile -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">মোবাইল</label>
                        <input type="text" id="edit-mobile"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Upazila -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">উপজেলা</label>
                        <select id="edit-upazila"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                            <option value="">নির্বাচন করুন</option>
                            <option value="কুষ্টিয়া সদর">কুষ্টিয়া সদর</option>
                            <option value="কুমারখালী">কুমারখালী</option>
                            <option value="খোকসা">খোকসা</option>
                            <option value="দৌলতপুর">দৌলতপুর</option>
                            <option value="মিরপুর">মিরপুর</option>
                            <option value="ভেড়ামারা">ভেড়ামারা</option>
                        </select>
                    </div>

                    <!-- Category -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">বিভাগ</label>
                        <input type="text" id="edit-category"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Amount -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">টাকার পরিমাণ</label>
                        <input type="number" id="edit-amount" step="1" min="0"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Bank -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">ব্যাংক</label>
                        <select id="edit-bank"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                            <option value="">নির্বাচন করুন</option>
                        </select>
                    </div>

                    <!-- Check No -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">চেক নং</label>
                        <input type="text" id="edit-check-no"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Check Date -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">চেক তারিখ</label>
                        <input type="date" id="edit-check-date"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Financial Year -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">অর্থবছর</label>
                        <select id="edit-financial-year"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                            <option value="">নির্বাচন করুন</option>
                            <option value="2025-26">2025-26</option>
                            <option value="2024-25">2024-25</option>
                            <option value="2023-24">2023-24</option>
                        </select>
                    </div>

                    <!-- Reference -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">সূত্র</label>
                        <input type="text" id="edit-reference"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">অবস্থা</label>
                        <select id="edit-status"
                            class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800">
                            <option value="delivered" selected>Delivered</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                </div>

                <!-- Address (full width) -->
                <div>
                    <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">ঠিকানা</label>
                    <textarea id="edit-address" rows="2"
                        class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800"></textarea>
                </div>

                <!-- Application Details (full width) -->
                <div>
                    <label class="block text-xs font-bold text-[#0d7377] mb-2 uppercase tracking-wide">আবেদনের বিবরণ</label>
                    <textarea id="edit-application-details" rows="3"
                        class="w-full px-4 py-2 border-2 border-[#a5f3fc] rounded-lg focus:outline-none focus:border-[#0d7377] focus:ring-2 focus:ring-[#5eead4] font-semibold text-gray-800"></textarea>
                </div>

                <!-- Save/Cancel buttons -->
                <div class="flex gap-3 mt-6 pt-4 border-t border-[#a5f3fc]">
                    <button type="submit" class="flex-1 py-3 px-4 rounded-xl font-bold text-sm bg-gradient-to-r from-[#0d7377] to-[#14919b] text-white shadow-lg hover:shadow-xl transition-all duration-200 active:scale-[0.98]">
                        সংরক্ষণ করুন
                    </button>
                    <button type="button" onmousedown="event.stopPropagation(); closeEditModal();" class="py-3 px-4 rounded-xl font-bold text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all duration-200">
                        বাতিল
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ───── DELETE CONFIRMATION MODAL ───── -->
    <div id="delete-modal" class="modal-backdrop fixed inset-0 z-[120] flex items-center justify-center p-4 hidden">
        <div class="modal-card bg-white w-full max-w-md rounded-[2rem] shadow-2xl p-6 relative">
            <!-- Warning Icon -->
            <div class="flex justify-center mb-4">
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-[#fef3c7] to-[#fbbf24] flex items-center justify-center border-2 border-[#f59e0b]">
                    <svg class="w-8 h-8 text-[#d97706]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
            </div>

            <h3 class="text-xl font-bold text-center text-gray-800 mb-2">নিশ্চিত করুন</h3>
            <p class="text-center text-gray-600 mb-6">
                আপনি কি নিশ্চিত যে এই রেকর্ডটি মুছে ফেলতে চান?<br>
                <span class="text-sm text-red-600 font-semibold mt-2 block">এই কাজটি পূর্বাবস্থায় ফেরানো যাবে না।</span>
            </p>

            <!-- Record preview -->
            <div class="bg-gray-50 rounded-lg p-3 mb-6 border border-gray-200">
                <p class="font-bold text-gray-800 mb-1" id="delete-preview-name"></p>
                <p class="text-sm text-gray-600" id="delete-preview-details"></p>
            </div>

            <!-- Action buttons -->
            <div class="flex gap-3">
                <button type="button" onmousedown="event.stopPropagation(); closeDeleteModal();" class="flex-1 py-3 px-4 rounded-xl font-bold text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 transition-all duration-200">
                    বাতিল
                </button>
                <button type="button" onmousedown="event.stopPropagation(); confirmDelete();" class="flex-1 py-3 px-4 rounded-xl font-bold text-sm bg-gradient-to-r from-[#ef4444] to-[#dc2626] text-white shadow-lg hover:shadow-xl transition-all duration-200 active:scale-[0.98]">
                    মুছে ফেলুন
                </button>
            </div>
        </div>
    </div>

    <!-- ───── SCRIPT ───── -->
    <script>
    // API URL Configuration - auto-detect based on environment
    const API_URL = (() => {
        const hostname = window.location.hostname;
        // Local development
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
            return `http://${hostname}:3000/api`;
        }
        // Production & default — same origin (Nginx proxies to Node)
        return '/api';
    })();

    // Format money in Bangladesh convention (e.g., 1,00,000 for lakh)
    // BD format: last 3 digits separated, then every 2 digits
    function formatBDMoney(amount) {
        if (amount === null || amount === undefined || isNaN(amount)) return '0';
        let num = Math.floor(Number(amount)); // Remove decimal points
        if (num === 0) return '0';
        let str = num.toString();
        if (str.length <= 3) return str;
        let lastThree = str.substring(str.length - 3);
        let otherNumbers = str.substring(0, str.length - 3);
        if (otherNumbers !== '') {
            lastThree = ',' + lastThree;
        }
        // Add comma every 2 digits for remaining numbers
        return otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree;
    }

    let selectedYear = "all";
    let searchTimeout;
    let availableYears = [];

    // ── load years ──
    async function loadFinancialYears() {
        const yearPanel = document.getElementById('yearPanel');
        try {
            yearPanel.innerHTML = `
                <div class="year-option active" data-year="all" onmousedown="pickYear(this, event)">
                    <span class="opt-dot"></span> সকল অর্থবছর
                </div>
                <div style="padding:10px 16px;text-align:center;">
                    <div class="spinner" style="width:16px;height:16px;border-width:2px;"></div>
                </div>`;
            const response = await fetch(`${API_URL}/humanitarian/years`);
            if (!response.ok) throw new Error('Failed to fetch years');
            availableYears = await response.json();
            yearPanel.innerHTML = `
                <div class="year-option active" data-year="all" onmousedown="pickYear(this, event)">
                    <span class="opt-dot"></span> সকল অর্থবছর
                </div>`;
            availableYears.forEach(year => {
                const option = document.createElement('div');
                option.className = 'year-option';
                option.setAttribute('data-year', year);
                option.setAttribute('onmousedown', 'pickYear(this, event)');
                option.innerHTML = `<span class="opt-dot"></span> ${year}`;
                yearPanel.appendChild(option);
            });
        } catch (error) {
            console.error('Failed to load financial years:', error);
            yearPanel.innerHTML = `
                <div class="year-option active" data-year="all" onmousedown="pickYear(this, event)">
                    <span class="opt-dot"></span> সকল অর্থবছর
                </div>
                <div class="year-option" data-year="2024-25" onmousedown="pickYear(this, event)">
                    <span class="opt-dot"></span> 2024-25
                </div>
                <div class="year-option" data-year="2025-26" onmousedown="pickYear(this, event)">
                    <span class="opt-dot"></span> 2025-26
                </div>`;
            availableYears = ['2024-25', '2025-26'];
        }
    }

    // ── year selector ──
    const yearBtn      = document.getElementById('yearBtn');
    const yearPanel    = document.getElementById('yearPanel');
    const yearBtnLabel = document.getElementById('yearBtnLabel');

    function toggleYearPanel(e) {
        e.stopPropagation();
        yearPanel.classList.toggle('open');
        yearBtn.classList.toggle('open');
    }
    function pickYear(el, e) {
        e.preventDefault(); e.stopPropagation();
        document.querySelectorAll('.year-option').forEach(o => o.classList.remove('active'));
        el.classList.add('active');
        selectedYear = el.dataset.year;
        yearBtnLabel.textContent = selectedYear === 'all' ? 'সকল অর্থবছর' : selectedYear;
        yearPanel.classList.remove('open');
        yearBtn.classList.remove('open');
        triggerSearch();
    }
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.year-select-wrap')) {
            yearPanel.classList.remove('open');
            yearBtn.classList.remove('open');
        }
    });

    // ── typewriter ──
    const input     = document.getElementById('search-input');
    const dropdown  = document.getElementById('dropdown');
    const resultsEl = document.getElementById('results');
    const moreHint  = document.getElementById('more-hint');

    const phText = "নাম, পিতা/মাতার নাম, মোবাইল, ঠিকানা বা ক্যাটাগরি দিয়ে খুঁজুন…";
    let idx = 0, isDeleting = false, spd = 80;
    function typeWriter() {
        input.setAttribute('placeholder', phText.slice(0, idx) + (idx < phText.length ? "|" : ""));
        if (!isDeleting && idx <= phText.length) { idx++; spd = 80; }
        if (idx > phText.length) { setTimeout(() => { isDeleting = true; typeWriter(); }, 2200); return; }
        if (isDeleting && idx >= 0) { idx--; spd = 42; }
        if (isDeleting && idx < 0) { isDeleting = false; idx = 0; spd = 600; }
        setTimeout(typeWriter, spd);
    }

    window.onload = function() { loadFinancialYears(); typeWriter(); };

    // ── search ──
    const MAX_SHOW = 10;
    const SHOW_WITHOUT_SCROLL = 5;

    input.addEventListener('input', () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(triggerSearch, 300);
    });

    async function triggerSearch() {
        const q = input.value.trim();
        if (q.length < 2) { dropdown.classList.add('hidden'); return; }

        resultsEl.innerHTML = '<div style="padding:18px;text-align:center;"><div class="spinner"></div></div>';
        dropdown.classList.remove('hidden');

        try {
            let url = `${API_URL}/humanitarian/search?q=${encodeURIComponent(q)}`;
            if (selectedYear !== 'all') url += `&year=${encodeURIComponent(selectedYear)}`;

            const response = await fetch(url);
            if (!response.ok) throw new Error('Search failed');
            const results = await response.json();

            resultsEl.innerHTML = '';
            if (results.length === 0) {
                resultsEl.innerHTML = '<div style="padding:18px;text-align:center;font-size:14px;color:#7dd3d0;">কোনো ফলাফল পাওয়া গেল না</div>';
                resultsEl.style.maxHeight = 'none';
                moreHint.classList.add('hidden');
                return;
            }

            resultsEl.style.maxHeight = results.length > SHOW_WITHOUT_SCROLL ? '400px' : 'none';

            results.slice(0, MAX_SHOW).forEach((r, i) => {
                const row = document.createElement('div');
                row.className = 'result-row';
                row.style.animationDelay = (i * 0.06) + 's';
                row.addEventListener('mousedown', (e) => { e.preventDefault(); showDetails(r); });

                // Format: Line 1: Name (bold), Financial Year, Amount
                // Line 2: Category, Father, Address, Upazila
                row.innerHTML = `
                    <div class="avatar-placeholder">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <div class="result-info">
                        <div class="result-line-1">
                            <span class="result-name">${r.name || ''}</span>
                            <span class="result-year-badge">${r.financial_year || ''}</span>
                            <span class="result-category">${r.category || ''}</span> <span style="margin:0 4px;">•</span>
                             <span class="result-amount">৳${formatBDMoney(r.amount_eng)}</span>

                        </div>
                        <div class="result-line-2">
                            
                            <span class="label">পিতা:</span> ${r.father_name || 'N/A'} <span style="margin:0 4px;">•</span>
                            <span class="label">ঠিকানা:</span> ${r.address || ''} <span style="margin:0 4px;">•</span>
                            <span class="label">উপজেলা:</span> ${r.upazila || ''}
                        </div>
                    </div>`;
                resultsEl.appendChild(row);
            });
            moreHint.classList.toggle('hidden', results.length <= MAX_SHOW);

        } catch (error) {
            console.error('Search error:', error);
            resultsEl.innerHTML = '<div style="padding:18px;text-align:center;font-size:14px;color:#ef4444;">সার্ভার ত্রুটি। অনুগ্রহ করে আবার চেষ্টা করুন।</div>';
            resultsEl.style.maxHeight = 'none';
            moreHint.classList.add('hidden');
        }
    }

    // ── close dropdown on outside click ──
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.sugg-wrap') && !e.target.closest('#modal')) {
            dropdown.classList.add('hidden');
        }
    });

    // ── modal ──
    function showDetails(r) {
        document.getElementById('m-name').innerText       = r.name || '';
        document.getElementById('m-category').innerText   = r.category || '';
        document.getElementById('m-father').innerText     = r.father_name || 'N/A';
        document.getElementById('m-mother').innerText     = r.mother_name || 'N/A';
        document.getElementById('m-nid').innerText        = r.nid_birth_reg_no || 'N/A';
        document.getElementById('m-profession').innerText = r.profession || 'N/A';
        document.getElementById('m-address').innerText    = r.address || 'N/A';
        document.getElementById('m-mobile').innerText     = r.mobile || 'N/A';
        document.getElementById('m-upazila').innerText    = r.upazila || '';
        document.getElementById('m-zila').innerText       = r.zila || 'কুষ্টিয়া';
        document.getElementById('m-relation').innerText   = r.relation_to_beneficiary || 'নিজ';
        document.getElementById('m-year').innerText       = r.financial_year || '';
        document.getElementById('m-amount').innerText     = "৳ " + formatBDMoney(r.amount_eng) + " টাকা";
        document.getElementById('m-bank').innerText       = r.bank || 'N/A';
        document.getElementById('m-check-no').innerText   = r.check_no || 'N/A';
        document.getElementById('m-check-date').innerText = r.check_date || 'N/A';
        document.getElementById('m-reference').innerText  = r.reference || 'N/A';
        document.getElementById('m-app-details').innerText = r.application_details || 'N/A';

        dropdown.classList.add('hidden');
        document.getElementById('modal').classList.add('open');
    }
    function closeModal() {
        document.getElementById('modal').classList.remove('open');
        triggerSearch();
    }

    // ─────────────────────────────────────────────────────────────
    // AUTHENTICATION & ADMIN FEATURES
    // ─────────────────────────────────────────────────────────────

    let isAdmin = false;
    let authToken = null;
    let currentRecordId = null;
    let currentRecord = null;
    let uniqueBanks = [];

    // Load unique bank names from database using search endpoint
    async function loadUniqueBanks() {
        try {
            console.log('Loading unique banks from database...');

            // Use common search terms including names and numbers
            const searchTerms = ['মোঃ', 'মো', 'আব্দুল', 'রহমান', 'আলী', '01', '02', '03'];
            const allRecords = [];
            const banks = new Set();

            for (const term of searchTerms) {
                try {
                    console.log(`Searching for term: "${term}"`);
                    const response = await fetch(`${API_URL}/humanitarian/search?q=${encodeURIComponent(term)}`);
                    console.log(`Response status for "${term}":`, response.status);

                    if (response.ok) {
                        const results = await response.json();
                        console.log(`Results for "${term}":`, results.length, 'records');

                        if (Array.isArray(results)) {
                            allRecords.push(...results);
                            results.forEach((record, idx) => {
                                if (record.bank && record.bank.trim() !== '') {
                                    banks.add(record.bank.trim());
                                }
                                // Log first record's bank field to see the data
                                if (idx === 0) {
                                    console.log(`First record bank for "${term}":`, record.bank);
                                }
                            });
                        }
                    } else {
                        const errorData = await response.json();
                        console.warn(`Failed to fetch records for term "${term}":`, errorData);
                    }
                } catch (err) {
                    console.warn(`Exception for term "${term}":`, err);
                }
            }

            uniqueBanks = Array.from(banks).sort();
            console.log(`Collected ${allRecords.length} total records from searches`);
            console.log(`Found ${uniqueBanks.length} unique banks:`, uniqueBanks);

            if (uniqueBanks.length === 0) {
                console.error('No banks found! Check if records have bank data.');
            }
        } catch (error) {
            console.error('Failed to load banks:', error);
            uniqueBanks = [];
        }
    }

    // Populate bank dropdown with current value selected
    function populateBankDropdown(currentBank) {
        const bankSelect = document.getElementById('edit-bank');

        console.log('Populating bank dropdown. Current bank:', currentBank);
        console.log('Available banks:', uniqueBanks);

        // Clear existing options
        bankSelect.innerHTML = '';

        // Add placeholder option
        const placeholderOption = document.createElement('option');
        placeholderOption.value = '';
        placeholderOption.textContent = 'নির্বাচন করুন';
        bankSelect.appendChild(placeholderOption);

        // Use available banks or fallback to common banks
        const banksToShow = uniqueBanks.length > 0 ? uniqueBanks : [
            'অগ্রণী ব্যাংক',
            'জনতা ব্যাংক',
            'ডাচ বাংলা ব্যাংক',
            'বাংলাদেশ কৃষি ব্যাংক',
            'রূপালী ব্যাংক',
            'শাহজালাল ইসলামী ব্যাংক',
            'সোনালী ব্যাংক'
        ];

        // Add all banks to dropdown
        banksToShow.forEach(bank => {
            const option = document.createElement('option');
            option.value = bank;
            option.textContent = bank;

            // Select current bank if it matches
            if (bank === currentBank) {
                option.selected = true;
            }

            bankSelect.appendChild(option);
        });

        // If current bank is not in the list, add it as the first selected option
        if (currentBank && !banksToShow.includes(currentBank)) {
            const currentOption = document.createElement('option');
            currentOption.value = currentBank;
            currentOption.textContent = `${currentBank} (বর্তমান)`;
            currentOption.selected = true;
            bankSelect.insertBefore(currentOption, bankSelect.children[1]); // Insert after placeholder
        }

        console.log(`Populated dropdown with ${bankSelect.options.length} options (including placeholder)`);
    }

    // Check if admin is logged in
    async function checkAdminAuth() {
        authToken = localStorage.getItem('zpk_admin_token');
        if (!authToken) {
            hideAdminUI();
            return;
        }

        try {
            const response = await fetch(`${API_URL}/auth/me`, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            });

            if (!response.ok) throw new Error('Invalid token');

            const user = await response.json();
            if (user.role === 'admin') {
                isAdmin = true;
                // Load banks when admin is authenticated
                loadUniqueBanks();
            }
            showAdminUI(user);
        } catch (error) {
            console.error('Auth check failed:', error);
            localStorage.removeItem('zpk_admin_token');
            localStorage.removeItem('zpk_admin_user');
            hideAdminUI();
        }
    }

    // Show admin UI elements
    function showAdminUI(user) {
        isAdmin = true;

        // Hide login button
        const loginButton = document.getElementById('login-button');
        if (loginButton) {
            loginButton.classList.add('hidden');
        }

        // Show dashboard button
        const dashboardButton = document.getElementById('dashboard-button');
        if (dashboardButton) {
            dashboardButton.classList.remove('hidden');
        }

        // Show admin profile
        const adminProfile = document.getElementById('admin-profile');
        if (adminProfile) {
            adminProfile.classList.remove('hidden');

            // Set profile info - show user's name
            const avatarEl = document.getElementById('admin-avatar');
            const nameEl = document.getElementById('admin-name');

            // Set avatar image or default silhouette
            if (avatarEl) {
                if (user.photo_path) {
                    avatarEl.innerHTML = `<img src="${user.photo_path}" alt="${user.full_name}" class="w-full h-full object-cover">`;
                } else {
                    avatarEl.innerHTML = `<svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%"><circle cx="20" cy="20" r="20" fill="#a5f3fc"/><circle cx="20" cy="16" r="7" fill="#fff" opacity="0.9"/><path d="M6 38c0-8 6-13 14-13s14 5 14 13" fill="#fff" opacity="0.9"/></svg>`;
                }
            }

            // Set user name
            if (nameEl) {
                nameEl.textContent = user.full_name || user.username;
            }
        }

        // Show edit/delete buttons when modal is shown
        // (buttons are shown/hidden in showDetails function)
    }

    // Hide admin UI elements
    function hideAdminUI() {
        isAdmin = false;

        // Show login button
        const loginButton = document.getElementById('login-button');
        if (loginButton) {
            loginButton.classList.remove('hidden');
        }

        // Hide dashboard button
        const dashboardButton = document.getElementById('dashboard-button');
        if (dashboardButton) {
            dashboardButton.classList.add('hidden');
        }

        // Hide admin profile
        const adminProfile = document.getElementById('admin-profile');
        if (adminProfile) {
            adminProfile.classList.add('hidden');
        }
    }

    // Logout function
    function logout() {
        localStorage.removeItem('zpk_admin_token');
        localStorage.removeItem('zpk_admin_user');
        window.location.href = '/admin/login.html';
    }

    // Toggle admin dropdown menu
    function toggleAdminDropdown(event) {
        event.stopPropagation();
        const profileCard = document.querySelector('.admin-profile-card');
        const dropdown = document.getElementById('admin-dropdown');

        profileCard.classList.toggle('open');
        dropdown.classList.toggle('open');
    }

    // Go to profile page
    function goToProfile() {
        // TODO: Create admin profile page
        window.location.href = '/admin/profile.html';
    }

    // Go to dashboard page
    function goToDashboard() {
        window.location.href = '/admin/';
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
        const adminProfile = document.getElementById('admin-profile');
        if (adminProfile && !adminProfile.contains(event.target)) {
            const profileCard = document.querySelector('.admin-profile-card');
            const dropdown = document.getElementById('admin-dropdown');
            if (profileCard) profileCard.classList.remove('open');
            if (dropdown) dropdown.classList.remove('open');
        }
    });

    // Modified showDetails to include edit/delete buttons for admins
    const originalShowDetails = showDetails;
    showDetails = function(r) {
        currentRecordId = r.id;
        currentRecord = r;

        // Call original function
        originalShowDetails(r);

        // Show admin actions for any logged-in user; delete only for admins
        const adminActions = document.getElementById('admin-actions');
        if (adminActions) {
            if (authToken) {
                adminActions.classList.remove('hidden');
                const deleteBtn = document.getElementById('delete-btn');
                if (deleteBtn) {
                    deleteBtn.style.display = isAdmin ? '' : 'none';
                }
            } else {
                adminActions.classList.add('hidden');
            }
        }
    }

    // ── EDIT MODAL ──
    async function openEditModal() {
        if (!currentRecord) {
            console.error('No record selected for editing');
            return;
        }

        console.log('Opening edit modal for record:', currentRecord);

        // Ensure banks are loaded before populating dropdown
        if (uniqueBanks.length === 0) {
            console.log('Banks not loaded yet, loading now...');
            await loadUniqueBanks();
        }

        // Populate all fields
        document.getElementById('edit-id').value = currentRecord.id;
        document.getElementById('edit-name').value = currentRecord.name || '';
        document.getElementById('edit-father-name').value = currentRecord.father_name || '';
        document.getElementById('edit-mother-name').value = currentRecord.mother_name || '';
        document.getElementById('edit-nid-birth').value = currentRecord.nid_birth_reg_no || '';
        document.getElementById('edit-profession').value = currentRecord.profession || '';
        document.getElementById('edit-relation').value = currentRecord.relation_to_beneficiary || '';
        document.getElementById('edit-address').value = currentRecord.address || '';
        document.getElementById('edit-upazila').value = currentRecord.upazila || '';
        document.getElementById('edit-mobile').value = currentRecord.mobile || '';
        document.getElementById('edit-category').value = currentRecord.category || '';
        // Remove decimal points from amount
        document.getElementById('edit-amount').value = Math.floor(currentRecord.amount_eng || 0);
        // Populate bank dropdown with current value first
        populateBankDropdown(currentRecord.bank || '');
        document.getElementById('edit-check-no').value = currentRecord.check_no || '';
        document.getElementById('edit-check-date').value = currentRecord.check_date || '';
        document.getElementById('edit-financial-year').value = currentRecord.financial_year || '';
        document.getElementById('edit-reference').value = currentRecord.reference || '';
        document.getElementById('edit-status').value = currentRecord.status || 'delivered';
        document.getElementById('edit-application-details').value = currentRecord.application_details || '';

        // Show edit modal with backdrop
        const editModal = document.getElementById('edit-modal');
        editModal.classList.remove('hidden');
        editModal.classList.add('open');
        setTimeout(() => {
            const modalCard = editModal.querySelector('.modal-card');
            if (modalCard) {
                modalCard.classList.add('open');
            }
        }, 10);
    }

    function closeEditModal() {
        const editModal = document.getElementById('edit-modal');
        const modalCard = editModal.querySelector('.modal-card');

        if (modalCard) {
            modalCard.classList.remove('open');
        }
        editModal.classList.remove('open');

        setTimeout(() => {
            editModal.classList.add('hidden');
        }, 300);
    }

    async function handleEditSubmit(e) {
        e.preventDefault();

        const recordId = document.getElementById('edit-id').value;
        const updateData = {
            name: document.getElementById('edit-name').value.trim(),
            father_name: document.getElementById('edit-father-name').value.trim(),
            mother_name: document.getElementById('edit-mother-name').value.trim(),
            nid_birth_reg_no: document.getElementById('edit-nid-birth').value.trim(),
            profession: document.getElementById('edit-profession').value.trim(),
            relation_to_beneficiary: document.getElementById('edit-relation').value.trim(),
            address: document.getElementById('edit-address').value.trim(),
            upazila: document.getElementById('edit-upazila').value,
            mobile: document.getElementById('edit-mobile').value.trim(),
            category: document.getElementById('edit-category').value.trim(),
            amount_eng: Math.floor(document.getElementById('edit-amount').value || 0),
            bank: document.getElementById('edit-bank').value.trim(),
            check_no: document.getElementById('edit-check-no').value.trim(),
            check_date: document.getElementById('edit-check-date').value,
            financial_year: document.getElementById('edit-financial-year').value,
            reference: document.getElementById('edit-reference').value.trim(),
            status: document.getElementById('edit-status').value,
            application_details: document.getElementById('edit-application-details').value.trim()
        };

        try {
            const response = await fetch(`${API_URL}/humanitarian/${recordId}/update`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(updateData)
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Update failed');
            }

            const result = await response.json();

            // Close edit modal
            closeEditModal();

            // Show success message
            alert('রেকর্ড সফলভাবে আপডেট করা হয়েছে');

            // Refresh the view modal with updated data
            const updatedResponse = await fetch(`${API_URL}/humanitarian/${recordId}`);
            if (updatedResponse.ok) {
                const updatedRecord = await updatedResponse.json();
                showDetails(updatedRecord);
            }

        } catch (error) {
            console.error('Edit error:', error);
            alert('ত্রুটি: ' + error.message);
        }
    }

    // ── DELETE MODAL ──
    function openDeleteModal() {
        if (!currentRecord) {
            console.error('No record selected for deletion');
            return;
        }

        // Show preview with more details
        document.getElementById('delete-preview-name').textContent = currentRecord.name || '';
        document.getElementById('delete-preview-details').textContent =
            `পিতা: ${currentRecord.father_name || 'N/A'} | উপজেলা: ${currentRecord.upazila || 'N/A'} | টাকা: ৳${formatBDMoney(currentRecord.amount_eng)}`;

        // Show delete modal with backdrop
        const deleteModal = document.getElementById('delete-modal');
        deleteModal.classList.remove('hidden');
        deleteModal.classList.add('open');
        setTimeout(() => {
            const modalCard = deleteModal.querySelector('.modal-card');
            if (modalCard) {
                modalCard.classList.add('open');
            }
        }, 10);
    }

    function closeDeleteModal() {
        const deleteModal = document.getElementById('delete-modal');
        const modalCard = deleteModal.querySelector('.modal-card');

        if (modalCard) {
            modalCard.classList.remove('open');
        }
        deleteModal.classList.remove('open');

        setTimeout(() => {
            deleteModal.classList.add('hidden');
        }, 300);
    }

    async function confirmDelete() {
        if (!currentRecordId) return;

        try {
            const response = await fetch(`${API_URL}/humanitarian/${currentRecordId}/delete`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || 'Delete failed');
            }

            // Close both modals
            closeDeleteModal();
            closeModal();

            // Show success message
            alert('রেকর্ড সফলভাবে মুছে ফেলা হয়েছে');

            // Clear search and refresh
            document.getElementById('search-input').value = '';
            dropdown.classList.add('hidden');

        } catch (error) {
            console.error('Delete error:', error);
            alert('ত্রুটি: ' + error.message);
        }
    }

    // Check authentication on page load
    window.addEventListener('DOMContentLoaded', () => {
        checkAdminAuth();
    });
    </script>
</body>
</html>
